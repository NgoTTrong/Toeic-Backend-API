datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

model User {
  id               String             @id
  createdAt        DateTime           @default(now())
  email            String?
  name             String?
  phone            String?
  avatar           String?
  address          String?
  rankId           String?
  rank             Rank?              @relation(fields: [rankId], references: [id])
  notifications    NotificationUser[]
  likeFeeds        LikeFeed[]
  commentFeeds     CommentFeed[]
  likeExams        LikeExam[]
  commentExams     CommentExam[]
  active           Active             @default(ACTIVE)
  likeCommentExams LikeCommentExam[]
  likeCommentFeeds LikeCommentFeed[]
  Feed             Feed[]
  Payment          Payment[]
  Part1            Part1[]

  @@index([id, email])
}

model Rank {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  name        String
  description String?
  rankIcon    String
  users       User[]

  @@index([id])
}

model Notification {
  id            String             @id @default(uuid())
  createdAt     DateTime           @default(now())
  title         String
  content       String
  notifications NotificationUser[]

  @@index([id])
}

model NotificationUser {
  id             String       @id @default(uuid())
  createdAt      DateTime     @default(now())
  userId         String
  notificationId String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([id])
}

model Feed {
  id         String        @id @default(uuid())
  createdAt  DateTime      @default(now())
  title      String
  content    String
  thumbnail  String
  categoryId String?
  active     Active        @default(ACTIVE)
  category   FeedCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  likes      LikeFeed[]
  comments   CommentFeed[]
  userId     String
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([id])
}

model FeedCategory {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  name       String
  color      String
  background String
  feeds      Feed[]

  @@index([id])
}

model LikeFeed {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  userId    String
  feedId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  feed      Feed     @relation(fields: [feedId], references: [id], onDelete: Cascade)

  @@index([feedId])
}

model CommentFeed {
  id            String            @id @default(uuid())
  createdAt     DateTime          @default(now())
  userId        String
  feedId        String
  content       String
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  feed          Feed              @relation(fields: [feedId], references: [id], onDelete: Cascade)
  parentId      String?
  parentComment CommentFeed?      @relation("ParentCommentFeed", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  childComments CommentFeed[]     @relation("ParentCommentFeed")
  likes         LikeCommentFeed[]

  @@index([feedId])
  @@index([parentId])
}

model LikeCommentFeed {
  id        String      @id @default(uuid())
  commentId String
  userId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  comment   CommentFeed @relation(fields: [commentId], references: [id], onDelete: Cascade)
}

model Exam {
  id           String        @id @default(uuid())
  createdAt    DateTime      @default(now())
  audioUrl     String
  breakPoints  Int[]
  thumbnail    String
  title        String
  introduction String
  numOfParts   Int
  duration     Int
  categoryId   String?
  category     ExamCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  likes        LikeExam[]
  comments     CommentExam[]
  part1Id      String
  part2Id      String
  part3Id      String
  part4Id      String
  part5Id      String
  part6Id      String
  part7Id      String
  part1        Part1         @relation(fields: [part1Id], references: [id])
  part2        Part2         @relation(fields: [part2Id], references: [id])
  part3        Part3         @relation(fields: [part3Id], references: [id])
  part4        Part4         @relation(fields: [part4Id], references: [id])
  part5        Part5         @relation(fields: [part5Id], references: [id])
  part6        Part6         @relation(fields: [part6Id], references: [id])
  part7        Part7         @relation(fields: [part7Id], references: [id])

  @@index([id])
}

model ExamCategory {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  name       String
  color      String
  background String
  exams      Exam[]

  @@index([id])
}

model LikeExam {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  userId    String
  examId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  exam      Exam     @relation(fields: [examId], references: [id], onDelete: Cascade)

  @@index([examId])
}

model CommentExam {
  id            String            @id @default(uuid())
  userId        String
  examId        String
  content       String
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  exam          Exam              @relation(fields: [examId], references: [id], onDelete: Cascade)
  parentId      String?
  parentComment CommentExam?      @relation("ParentCommentExam", fields: [parentId], references: [id], onDelete: Cascade)
  childComments CommentExam[]     @relation("ParentCommentExam")
  likes         LikeCommentExam[]

  @@index([examId])
}

model LikeCommentExam {
  id        String      @id @default(uuid())
  commentId String
  userId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  comment   CommentExam @relation(fields: [commentId], references: [id], onDelete: Cascade)
}

model Part1 {
  id             String          @id @default(uuid())
  title          String?
  thumbnail      String?
  introduction   String?
  creatorId      String?
  numOfQuestions Int?
  duration       Int?
  exams          Exam[]
  part1Questions Part1Question[]
  creator        User?           @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([id])
}

model Part1Question {
  id         String   @id @default(uuid())
  audioUrl   String
  imageUrls  String[]
  questionId String
  part1Id    String
  topicId    String?  @unique
  explainId  String?  @unique
  part1      Part1    @relation(fields: [part1Id], references: [id])
  question   Question @relation(fields: [questionId], references: [id])
  topic      Topic?   @relation(fields: [topicId], references: [id])
  explain    Explain? @relation(fields: [explainId], references: [id])

  @@index([id, part1Id])
}

model Part2 {
  id             String          @id @default(uuid())
  createdAt      DateTime        @default(now())
  thumbnail      String
  introduction   String
  numOfQuestions Int
  duration       Int?
  exams          Exam[]
  part2Questions Part2Question[]

  @@index([id])
}

model Part2Question {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  audioUrl   String
  questionId String
  part2Id    String
  topicId    String?  @unique
  explainId  String?  @unique
  part2      Part2    @relation(fields: [part2Id], references: [id])
  question   Question @relation(fields: [questionId], references: [id])
  topic      Topic?   @relation(fields: [topicId], references: [id])
  explain    Explain? @relation(fields: [explainId], references: [id])

  @@index([id, part2Id])
}

model Part3 {
  id             String          @id @default(uuid())
  createdAt      DateTime        @default(now())
  thumbnail      String
  introduction   String
  numOfQuestions Int
  duration       Int?
  exams          Exam[]
  part3Questions Part3Question[]

  @@index([id])
}

model Part3Question {
  id                  String                 @id @default(uuid())
  createdAt           DateTime               @default(now())
  audioUrl            String
  imageUrls           String[]
  part3Id             String
  part3               Part3                  @relation(fields: [part3Id], references: [id])
  groupPart3Questions MappingPart3Question[]
  topicId             String?                @unique
  explainId           String?                @unique
  topic               Topic?                 @relation(fields: [topicId], references: [id])
  explain             Explain?               @relation(fields: [explainId], references: [id])

  @@index([id, part3Id])
}

model MappingPart3Question {
  part3QuestionId String
  questionId      String
  part3Question   Part3Question @relation(fields: [part3QuestionId], references: [id])
  question        Question      @relation(fields: [questionId], references: [id])

  @@id([part3QuestionId, questionId])
  @@index([part3QuestionId, questionId])
}

model Part4 {
  id             String          @id @default(uuid())
  createdAt      DateTime        @default(now())
  thumbnail      String
  introduction   String
  numOfQuestions Int
  duration       Int?
  exams          Exam[]
  part4Questions Part4Question[]

  @@index([id])
}

model Part4Question {
  id                  String                 @id @default(uuid())
  createdAt           DateTime               @default(now())
  audioUrl            String
  imageUrls           String[]
  part4Id             String
  part4               Part4                  @relation(fields: [part4Id], references: [id])
  groupPart4Questions MappingPart4Question[]
  topicId             String?                @unique
  explainId           String?                @unique
  topic               Topic?                 @relation(fields: [topicId], references: [id])
  explain             Explain?               @relation(fields: [explainId], references: [id])

  @@index([id, part4Id])
}

model MappingPart4Question {
  part4QuestionId String
  questionId      String
  part4Question   Part4Question @relation(fields: [part4QuestionId], references: [id])
  question        Question      @relation(fields: [questionId], references: [id])

  @@id([questionId, part4QuestionId])
  @@index([part4QuestionId, questionId])
}

model Part5 {
  id             String          @id @default(uuid())
  createdAt      DateTime        @default(now())
  thumbnail      String
  introduction   String
  numOfQuestions Int
  duration       Int?
  exams          Exam[]
  part5Questions Part5Question[]

  @@index([id])
}

model Part5Question {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  part5Id    String
  questionId String
  part5      Part5    @relation(fields: [part5Id], references: [id])
  question   Question @relation(fields: [questionId], references: [id])
  topicId    String?  @unique
  explainId  String?  @unique
  topic      Topic?   @relation(fields: [topicId], references: [id])
  explain    Explain? @relation(fields: [explainId], references: [id])

  @@index([part5Id, questionId])
}

model Part6 {
  id             String          @id @default(uuid())
  createdAt      DateTime        @default(now())
  thumbnail      String
  introduction   String
  numOfQuestions Int
  duration       Int?
  exams          Exam[]
  part6Questions Part6Question[]

  @@index([id])
}

model Part6Question {
  id                  String                 @id @default(uuid())
  createdAt           DateTime               @default(now())
  imageUrls           String[]
  part6Id             String
  part6               Part6                  @relation(fields: [part6Id], references: [id])
  groupPart6Questions MappingPart6Question[]
  topicId             String?                @unique
  explainId           String?                @unique
  topic               Topic?                 @relation(fields: [topicId], references: [id])
  explain             Explain?               @relation(fields: [explainId], references: [id])

  @@index([id, part6Id])
}

model MappingPart6Question {
  part6QuestionId String
  questionId      String
  part6Question   Part6Question @relation(fields: [part6QuestionId], references: [id])
  question        Question      @relation(fields: [questionId], references: [id])

  @@id([part6QuestionId, questionId])
  @@index([questionId, part6QuestionId])
}

model Part7 {
  id             String          @id @default(uuid())
  createdAt      DateTime        @default(now())
  thumbnail      String
  introduction   String
  numOfQuestions Int
  duration       Int?
  exams          Exam[]
  part7Question  Part7Question[]

  @@index([id])
}

model Part7Question {
  id                  String                 @id @default(uuid())
  createdAt           DateTime               @default(now())
  imageUrls           String[]
  part7Id             String
  part7               Part7                  @relation(fields: [part7Id], references: [id])
  groupPart7Questions MappingPart7Question[]
  topicId             String?                @unique
  explainId           String?                @unique
  topic               Topic?                 @relation(fields: [topicId], references: [id])
  explain             Explain?               @relation(fields: [explainId], references: [id])

  @@index([id, part7Id])
}

model MappingPart7Question {
  part7QuestionId String
  questionId      String
  part7Question   Part7Question @relation(fields: [part7QuestionId], references: [id])
  question        Question      @relation(fields: [questionId], references: [id])

  @@id([part7QuestionId, questionId])
  @@index([part7QuestionId, questionId])
}

model Question {
  id             String                 @id @default(uuid())
  createdAt      DateTime               @default(now())
  content        String
  optionA        String?
  optionB        String?
  optionC        String?
  optionD        String?
  part1Questions Part1Question[]
  part2Questions Part2Question[]
  part3Questions MappingPart3Question[]
  part4Questions MappingPart4Question[]
  part5Questions Part5Question[]
  part6Questions MappingPart6Question[]
  part7Questions MappingPart7Question[]

  @@index([id])
}

model Topic {
  id            String         @id @default(uuid())
  name          String
  Part1Question Part1Question?
  Part2Question Part2Question?
  Part3Question Part3Question?
  Part4Question Part4Question?
  Part5Question Part5Question?
  Part6Question Part6Question?
  Part7Question Part7Question?

  @@index([id])
}

model Explain {
  id            String         @id @default(uuid())
  explain       String
  images        String[]
  answer        Answer
  Part1Question Part1Question?
  Part2Question Part2Question?
  Part3Question Part3Question?
  Part4Question Part4Question?
  Part5Question Part5Question?
  Part6Question Part6Question?
  Part7Question Part7Question?

  @@index([id])
}

model Course {
  id          String          @id @default(uuid())
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  userId      String
  title       String
  description String?
  imageUrl    String?
  price       Float?
  isPublished Boolean         @default(false)
  categoryId  String?
  category    CourseCategory? @relation(fields: [categoryId], references: [id])
  attachments Attachment[]
  chapters    Chapter[]
  payment     Payment[]

  @@index([categoryId])
}

model Attachment {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String
  url       String
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
}

model CourseCategory {
  id      String   @id @default(uuid())
  name    String   @unique
  courses Course[]
}

model Chapter {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  title       String
  description String?
  videoUrl    String?
  position    Int
  isPublished Boolean  @default(false)
  isFree      Boolean  @default(false)

  courseId     String
  course       Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
  userProgress UserProgress[]

  @@index([courseId])
}

model Payment {
  id       String @id @default(uuid())
  userId   String
  courseId String
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId])
}

model UserProgress {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  isCompleted Boolean  @default(false)
  chapter     Chapter  @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  chapterId   String
  userId      String

  @@unique([userId, chapterId])
  @@index([chapterId])
}

enum Answer {
  A
  B
  C
  D
}

enum Active {
  ACTIVE
  INACTIVE
}
